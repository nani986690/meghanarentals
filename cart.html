<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#fff6e6" />
  <title>Cart - Meghana Bridal Dresses</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    :root{ --accent:#d4af37; --accent-2:#f4d03f; --muted:#2a2a2a }
    body{ font-family: 'Montserrat', Arial, sans-serif; background: #faf8f3; color:#1a1a1a }
    .cart-page-header { background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: white; padding: 20px; text-align: center; }
    .cart-page-content { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    .cart-items-list { display: grid; gap: 20px; margin-bottom: 40px; }
    .cart-item-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: grid; grid-template-columns: 120px 1fr auto; gap: 20px; align-items: center; }
    .cart-item-card img { width: 120px; height: 150px; object-fit: cover; border-radius: 8px; }
    .item-info h3 { margin: 0 0 10px 0; color: var(--accent); }
    .item-info p { margin: 5px 0; color: var(--muted); font-size: 14px; }
    .item-actions { display: flex; gap: 10px; flex-direction: column; }
    .item-actions button { padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
    .remove-btn { background: #f3f3f3; color: #d9534f; }
    .remove-btn:hover { background: #e6e6e6; }
    .checkout-item-btn { background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: white; }
    .checkout-item-btn:hover { opacity: 0.95; }
    .cart-summary { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
    .summary-row { display: flex; justify-content: space-between; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(0,0,0,0.06); }
    .summary-total { font-weight: 700; font-size: 18px; color: var(--accent); }
    .checkout-btn-main { width: 100%; padding: 15px; margin-top: 20px; background: linear-gradient(90deg, var(--accent), var(--accent-2)); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
    .continue-shopping { text-align: center; margin-top: 30px; }
    .continue-shopping a { color: var(--accent); text-decoration: none; font-weight: 600; }
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-state h2 { color: var(--accent); margin-bottom: 10px; }
    .empty-state p { color: var(--muted); margin-bottom: 20px; }
    .rental-options { margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.06); display: flex; flex-direction: column; gap: 10px; }
    .rental-options label { font-size: 13px; display: flex; flex-direction: column; gap: 5px; }
    .rental-options select, .rental-options input { padding: 8px; border: 1px solid rgba(212,175,55,0.3); border-radius: 6px; font-family: inherit; background: #fafaf8; color: #1a1a1a; }
    .rental-options select:focus, .rental-options input:focus { outline: none; border-color: var(--accent); background: #fff; }
    @media (max-width: 768px) {
      .cart-item-card { grid-template-columns: 80px 1fr; }
      .item-actions { flex-direction: row; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="logo.png" alt="Meghana Rental Dresses" class="site-logo" />
      <span>Meghana Bridal Dresses</span>
    </div>
    <nav>
      <a href="index.html">WOMEN'S WEAR</a>
      <a href="men.html">MEN'S WEAR</a>
      <a href="about.html">ABOUT</a>
      <a href="contact.html">CONTACT</a>
      <a href="cart.html" class="active">CART</a>
    </nav>
  </header>

  <div class="cart-page-header">
    <h1>Your Shopping Cart</h1>
  </div>

  <div class="cart-page-content">
    <div id="cartItemsContainer" class="cart-items-list">
      <!-- Cart items will be populated here -->
    </div>

    <div id="emptyCartMessage" class="empty-state" style="display: none;">
      <h2>Your cart is empty</h2>
      <p>Browse our collection and add items to your cart</p>
      <a href="index.html" class="btn btn-primary">Continue Shopping</a>
    </div>

    <div id="cartSummaryContainer" style="display: none;">
      <div class="cart-summary">
        <div class="summary-row">
          <span>Total Items:</span>
          <span id="summaryItems">0</span>
        </div>
        <div class="summary-row">
          <span>Total Rent:</span>
          <span id="summaryRent">₹0</span>
        </div>
        <!-- Total Deposit row removed -->
        <div class="summary-row summary-total">
          <span>Total Amount:</span>
          <span id="summaryTotal">₹0</span>
        </div>
        <button class="checkout-btn-main" id="checkoutAllBtn">Proceed to Checkout</button>
      </div>
      <div class="continue-shopping">
        <a href="index.html">← Continue Shopping</a>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Ensure we use the existing global `cart` variable (script.js defines it). If not present, load from localStorage.
    cart = (typeof cart !== 'undefined') ? cart : JSON.parse(localStorage.getItem("cart")) || [];

    function renderCartPage() {
      const container = document.getElementById("cartItemsContainer");
      const emptyMsg = document.getElementById("emptyCartMessage");
      const summary = document.getElementById("cartSummaryContainer");

      if(cart.length === 0) {
        container.style.display = "none";
        summary.style.display = "none";
        emptyMsg.style.display = "block";
        return;
      }

      container.style.display = "grid";
      summary.style.display = "block";
      emptyMsg.style.display = "none";

      container.innerHTML = "";

      cart.forEach((item, idx) => {
        const card = document.createElement("div");
        card.className = "cart-item-card";
        card.innerHTML = `
          <img src="${item.img}" alt="${item.name}" />
          <div class="item-info">
            <h3>${item.name}</h3>
            <p><strong>Rent:</strong> ₹${item.price.toLocaleString()}</p>
            <p><strong>Quantity:</strong> ${item.qty}</p>
            <p><strong>Subtotal:</strong> ₹${(item.price * item.qty).toLocaleString()}</p>
            <div class="rental-options">
              <label>
                <strong>Size:</strong>
                <select class="size-select" data-index="${idx}">
                  <option value="">Select Size</option>
                  <option value="XS">XS</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                  <option value="XXL">XXL</option>
                </select>
              </label>
              <label>
                <strong>Rental Duration:</strong>
                <select class="duration-select" data-index="${idx}">
                  <option value="">Select Duration</option>
                  <option value="1">1 Day</option>
                  <option value="2">2 Days</option>
                  <option value="3">3 Days</option>
                  <option value="7">1 Week</option>
                </select>
              </label>
              <label>
                <strong>Event Date:</strong>
                <input type="date" class="date-select" data-index="${idx}" />
              </label>
            </div>
          </div>
          <div class="item-actions">
            <button class="checkout-item-btn" data-index="${idx}">Checkout</button>
            <button class="remove-btn" data-index="${idx}">Remove</button>
          </div>
        `;

        const checkoutBtn = card.querySelector(".checkout-item-btn");
        checkoutBtn.addEventListener("click", () => checkoutItem(idx));

        const removeBtn = card.querySelector(".remove-btn");
        removeBtn.addEventListener("click", () => removeItem(idx));

        // Store rental details when user selects them
        const sizeSelect = card.querySelector(".size-select");
        const durationSelect = card.querySelector(".duration-select");
        const dateSelect = card.querySelector(".date-select");

        sizeSelect.addEventListener("change", (e) => {
          cart[idx].size = e.target.value;
          saveCart();
        });

        durationSelect.addEventListener("change", (e) => {
          cart[idx].duration = e.target.value;
          saveCart();
        });

        dateSelect.addEventListener("change", (e) => {
          cart[idx].eventDate = e.target.value;
          saveCart();
        });

        container.appendChild(card);
      });

      updateSummary();
    }

    function removeItem(idx) {
      if(confirm("Remove this item from cart?")) {
        cart.splice(idx, 1);
        saveCart();
        renderCartPage();
        updateCartCount();
      }
    }

    function checkoutItem(idx) {
      const item = cart[idx];
      let message = `Hi, I'd like to rent the *${item.name}*.

Quantity: ${item.qty}
Rent per item: ₹${item.price.toLocaleString()}
Total: ₹${(item.price * item.qty).toLocaleString()}

`;
      
      if (item.size) message += `Size: ${item.size}
`;
      if (item.duration) message += `Rental Duration: ${item.duration} Day(s)
`;
      if (item.eventDate) message += `Event Date: ${item.eventDate}
`;
      
      message += `
Please confirm the booking.`;

      const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    }

    function updateSummary() {
      const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);
      const totalRent = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
      const totalAmount = totalRent;

      document.getElementById("summaryItems").textContent = totalItems;
      document.getElementById("summaryRent").textContent = `₹${totalRent.toLocaleString()}`;
      // Deposit row removed, so no update for summaryDeposit
      document.getElementById("summaryTotal").textContent = `₹${totalAmount.toLocaleString()}`;
    }

    function checkoutAll() {
      if(cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }

      let message = "Hi, I'd like to rent these items:\n\n";
      cart.forEach(item => {
        message += `${item.name}\n`;
        message += `Quantity: ${item.qty} × ₹${item.price.toLocaleString()} (Rent: ₹${(item.price).toLocaleString()})\n`;
        if (item.size) message += `Size: ${item.size}\n`;
        if (item.duration) message += `Rental Duration: ${item.duration} Day(s)\n`;
        if (item.eventDate) message += `Event Date: ${item.eventDate}\n`;
        message += `\n`;
      });

      const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);
      const totalRent = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
      const totalAmount = totalRent;

      message += `\nTotal Items: ${totalItems}\n`;
      message += `Total Rent: ₹${totalRent.toLocaleString()}\n`;
      message += `Total Amount: ₹${totalAmount.toLocaleString()}\n\n`;
      message += `Please confirm the booking.`;

      const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");
    }

    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function updateCartCount() {
      const cartBtn = document.getElementById("openCartBtn");
      const totalQty = cart.reduce((sum, i) => sum + i.qty, 0);
      if(cartBtn) cartBtn.textContent = `Cart (${totalQty})`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderCartPage();
      document.getElementById("checkoutAllBtn")?.addEventListener("click", checkoutAll);
      updateCartCount();
    });
  </script>
</body>
</html>